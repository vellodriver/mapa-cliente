<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoidmVsbG9kcml2ZXIiLCJhIjoiY21iMGc2azhiMHcyNDJrcTJrN3F3dnp1bSJ9.A6iU7GA4IixnaTbhJPe9hQ';

  const params = new URLSearchParams(window.location.search);
  const origem = params.get("origem")?.split(',').map(Number) || [-43.2096, -22.9035];
  const destino = params.get("destino")?.split(',').map(Number) || [-46.6333, -23.5505];

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/navigation-day-v1', // â† estilo bicolor claro
    center: origem,
    zoom: 5
  });

  map.on('load', () => {
    const createMarker = (coords) => {
      const el = document.createElement('div');
      el.className = 'custom-marker';
      new mapboxgl.Marker(el).setLngLat(coords).addTo(map);
    };
    createMarker(origem);
    createMarker(destino);

    const bounds = new mapboxgl.LngLatBounds();
    bounds.extend(origem);
    bounds.extend(destino);
    map.fitBounds(bounds, {
      padding: {
        top: 80,
        bottom: 550,
        left: 80,
        right: 80
      }
    });

    getRoute();
  });

  async function getRoute() {
    const query = await fetch(
      `https://api.mapbox.com/directions/v5/mapbox/driving/${origem.join(',')};${destino.join(',')}?geometries=geojson&access_token=${mapboxgl.accessToken}`
    );
    const json = await query.json();
    const data = json.routes[0].geometry;

    map.addSource('route', {
      type: 'geojson',
      data: {
        type: 'Feature',
        properties: {},
        geometry: data
      }
    });

    map.addLayer({
      id: 'route',
      type: 'line',
      source: 'route',
      layout: { 'line-join': 'round', 'line-cap': 'round' },
      paint: {
        'line-color': '#0A3D62',
        'line-width': 4
      }
    });
  }
</script>
